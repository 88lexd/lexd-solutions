---
- name: Check if /data exist
  stat:
    path: /data
  register: data_mount_path

- name: Create path for GlusterFS to mount
  file:
    path: /data
    state: directory
  when: not data_mount_path.stat.exists

- name: Mount GlusterFS
  ansible.posix.mount:
    path: /data
    src: "localhost:/k8s-volume"
    fstype: glusterfs
    state: mounted
  register: mount_result

- name: Apply 777 on the glusterfs volume (run once only - endpoint is the same on all nodes)
  file:
    path: /data
    state: directory
    owner: root
    group: root
    mode: '0777'
  run_once: yes
  when: mount_result.changed
